dist: trusty
language: ruby
cache: bundler
sudo: required
bundler_args: --without production

services:
  - mysql

branches:
  only:
    - master
    - develop

before_install:
  - sudo service mysql restart
  - gem update --system
  - gem install bundler

before_script:
  - bundle exec rake keycard:migrate RAILS_ENV=test
  - bundle exec rake checkpoint:migrate RAILS_ENV=test
  - bundle exec rails db:setup
  - bundle exec rake otis:migrate_users RAILS_ENV=test

script:
  - bundle exec rubocop
  - bundle exec rails test
